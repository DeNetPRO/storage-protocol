<!doctype html>
<html lang="en">
<head>
    <title>Code coverage report for contracts/Governance.sol</title>
    <meta charset="utf-8" />
    <link rel="stylesheet" href="../prettify.css" />
    <link rel="stylesheet" href="../base.css" />
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <style type='text/css'>
        .coverage-summary .sorter {
            background-image: url(../sort-arrow-sprite.png);
        }
    </style>
</head>
<body>
<div class='wrapper'>
  <div class='pad1'>
    <h1>
      <a href="../index.html">all files</a> / <a href="index.html">contracts/</a> Governance.sol
    </h1>
    <div class='clearfix'>
      <div class='fl pad1y space-right2'>
        <span class="strong">13.73% </span>
        <span class="quiet">Statements</span>
        <span class='fraction'>7/51</span>
      </div>
      <div class='fl pad1y space-right2'>
        <span class="strong">3.85% </span>
        <span class="quiet">Branches</span>
        <span class='fraction'>1/26</span>
      </div>
      <div class='fl pad1y space-right2'>
        <span class="strong">18.18% </span>
        <span class="quiet">Functions</span>
        <span class='fraction'>2/11</span>
      </div>
      <div class='fl pad1y space-right2'>
        <span class="strong">13.73% </span>
        <span class="quiet">Lines</span>
        <span class='fraction'>7/51</span>
      </div>
    </div>
  </div>
  <div class='status-line low'></div>
<pre><table class="coverage">
<tr><td class="line-count quiet">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
62
63
64
65
66
67
68
69
70
71
72
73
74
75
76
77
78
79
80
81
82
83
84
85
86
87
88
89
90
91
92
93
94
95
96
97
98
99
100
101
102
103
104
105
106
107
108
109
110
111
112
113
114
115
116
117
118
119
120
121
122
123
124
125
126
127
128
129
130
131
132
133
134
135
136
137
138
139
140
141
142</td><td class="line-coverage quiet"><span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">1×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">1×</span>
<span class="cline-any cline-yes">1×</span>
<span class="cline-any cline-yes">1×</span>
<span class="cline-any cline-yes">1×</span>
<span class="cline-any cline-yes">1×</span>
<span class="cline-any cline-yes">1×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span></td><td class="text"><pre class="prettyprint lang-js">// SPDX-License-Identifier: MIT
/*
    Created by DeNet
&nbsp;
    This Contract - ope of step for moving from rating to VDF, before VDF not realized.
*/
&nbsp;
pragma solidity ^0.8.0;
&nbsp;
import "@openzeppelin/contracts/access/Ownable.sol";
import "@openzeppelin/contracts/utils/math/SafeMath.sol";
import "@openzeppelin/contracts/token/ERC20/IERC20.sol";
import "./interfaces/IGovernance.sol";
&nbsp;
contract Selection is Ownable {
    using SafeMath for uint;
&nbsp;
    mapping (address =&gt; uint256) public timeVote; // date of last vote
&nbsp;
    uint256 public votesCount;
    uint256 public votesAmount;
&nbsp;
    uint256 public lastVotePeriod; // last vote time 
    uint256 public minVote;
    uint256 public maxVote;
    uint256 public votePeriod; // when update 
    uint256 public currentState; // current result (between min and max)
&nbsp;
    string public contractName;
&nbsp;
<span class="fstat-no" title="function not covered" >    constructor (uint _minVote, uint _maxVote, string memory _name, uint _period) {</span>
<span class="cstat-no" title="statement not covered" >        minVote = _minVote</span>;
<span class="cstat-no" title="statement not covered" >        maxVote = _maxVote</span>;
<span class="cstat-no" title="statement not covered" >        contractName = _name</span>;
<span class="cstat-no" title="statement not covered" >        votePeriod = _period</span>;
<span class="cstat-no" title="statement not covered" >        currentState = (minVote  + maxVote) / 2</span>;
    }
&nbsp;
<span class="fstat-no" title="function not covered" >    function getCurPeriod() public view returns(uint) {</span>
<span class="cstat-no" title="statement not covered" >        return block.timestamp / votePeriod;</span>
    }
    
<span class="fstat-no" title="function not covered" >    function getCurrentState() public view returns (uint256){</span>
<span class="cstat-no" title="statement not covered" >        uint nowPeriod = getCurPeriod();</span>
<span class="cstat-no" title="statement not covered" >        if (nowPeriod == lastVotePeriod) {</span>
<span class="cstat-no" title="statement not covered" >            return currentState;</span>
        } else {
<span class="cstat-no" title="statement not covered" >            if (votesCount != 0) {</span>
<span class="cstat-no" title="statement not covered" >                return (currentState + votesAmount) / (votesCount + 1);</span>
            } else {
<span class="cstat-no" title="statement not covered" >                return (currentState + maxVote + minVote) / 3;</span>
            }
        }
    }
&nbsp;
<span class="fstat-no" title="function not covered" >    function _updateVotes() internal {</span>
<span class="cstat-no" title="statement not covered" >        if (votesCount == 0) {</span>
<span class="cstat-no" title="statement not covered" >            currentState = (currentState + maxVote + minVote) / 3</span>;
        } else {
<span class="cstat-no" title="statement not covered" >            currentState = (currentState + votesAmount) / (votesCount + 1)</span>;
        }
<span class="cstat-no" title="statement not covered" >        votesCount = 0</span>;
<span class="cstat-no" title="statement not covered" >        votesAmount = 0</span>;
    }
&nbsp;
<span class="fstat-no" title="function not covered" >    function voteFor(address account, uint vote, uint votePower) public onlyOwner {</span>
<span class="cstat-no" title="statement not covered" >        require(vote &gt;= minVote, "vote &lt; minVote")</span>;
<span class="cstat-no" title="statement not covered" >        require(vote &lt;= maxVote, "vote &lt; minVote")</span>;
<span class="cstat-no" title="statement not covered" >        require(votePower &gt; 0, "votePower &lt; 0")</span>;
<span class="cstat-no" title="statement not covered" >        uint nowPeriod = getCurPeriod();</span>
<span class="cstat-no" title="statement not covered" >        if (nowPeriod != lastVotePeriod) {</span>
<span class="cstat-no" title="statement not covered" >            _updateVotes()</span>;
<span class="cstat-no" title="statement not covered" >            lastVotePeriod = nowPeriod</span>;
        }
<span class="cstat-no" title="statement not covered" >        uint accountPeriod = timeVote[account];</span>
<span class="cstat-no" title="statement not covered" >        if (accountPeriod != nowPeriod) {</span>
<span class="cstat-no" title="statement not covered" >            votesAmount += vote * votePower</span>;
<span class="cstat-no" title="statement not covered" >            votesCount += votePower</span>; 
        }
    }
}
&nbsp;
contract Governance is Ownable, IGovernance {
    address public depositTokenAddresss = address(0);
&nbsp;
    using SafeMath for uint;
&nbsp;
    mapping (address =&gt; uint256) public depositedBalance;
    mapping (address =&gt; uint256) public lockedAmounts;
    mapping (address =&gt; uint256) public unlockTime;
    mapping (uint256 =&gt; uint256) public votes;
    uint256 public lockPeriod = 86400; // one day
&nbsp;
    constructor (address _token) {
        depositTokenAddresss = _token;
    }
&nbsp;
<span class="fstat-no" title="function not covered" >    function updateLockTime(uint256 newPeriod) public onlyOwner {</span>
<span class="cstat-no" title="statement not covered" >        lockPeriod = newPeriod</span>;
    }
&nbsp;
<span class="fstat-no" title="function not covered" >    function balanceOf(address account) public view returns(uint256) {</span>
    
<span class="cstat-no" title="statement not covered" >        if (block.timestamp  &lt; unlockTime[account]) {</span>
<span class="cstat-no" title="statement not covered" >            return depositedBalance[account].sub(lockedAmounts[account]);</span>
        }
<span class="cstat-no" title="statement not covered" >        return depositedBalance[account];</span>
    }
&nbsp;
<span class="fstat-no" title="function not covered" >    function vote(uint256 voteID,  uint256 votePower) public {</span>
<span class="cstat-no" title="statement not covered" >        address account = msg.sender;</span>
<span class="cstat-no" title="statement not covered" >        require(balanceOf(account) &gt;= votePower, "vote power &gt; unlocked deposit")</span>;
<span class="cstat-no" title="statement not covered" >        if (block.timestamp &lt; unlockTime[account]) {</span>
<span class="cstat-no" title="statement not covered" >            lockedAmounts[account] = lockedAmounts[account].add(votePower)</span>;    
        } else {
<span class="cstat-no" title="statement not covered" >            lockedAmounts[account] = votePower</span>;
        }
<span class="cstat-no" title="statement not covered" >        unlockTime[account] = block.timestamp + lockPeriod</span>;
<span class="cstat-no" title="statement not covered" >        votes[voteID] = votes[voteID].add(votePower)</span>;
    }
&nbsp;
    function depositToken(uint256 amount) public {
        /*
            1. token.Approve(address(governance), infinity);
            2. 
        */
        IERC20 token = IERC20(depositTokenAddresss);
        uint256 balanceBefore = token.balanceOf(address(this));
        <span class="missing-if-branch" title="else path not taken" >E</span>require(token.transferFrom(msg.sender, address(this), amount), "Can't transfer funds");
        uint256 amountToAdd = token.balanceOf(address(this)).sub(balanceBefore);
        depositedBalance[msg.sender] = depositedBalance[msg.sender].add(amountToAdd);
        emit Deposit(msg.sender, amountToAdd);
    }
&nbsp;
<span class="fstat-no" title="function not covered" >    function withdrawToken(uint256 amount) public {</span>
<span class="cstat-no" title="statement not covered" >        IERC20 token = IERC20(depositTokenAddresss);</span>
<span class="cstat-no" title="statement not covered" >        require(balanceOf(msg.sender) &gt;= amount, "Amount &gt; unlocked deposit")</span>;
<span class="cstat-no" title="statement not covered" >        depositedBalance[msg.sender] = depositedBalance[msg.sender].sub(amount)</span>;
<span class="cstat-no" title="statement not covered" >        token.transfer(msg.sender, amount)</span>;
<span class="cstat-no" title="statement not covered" >        emit Withdraw(msg.sender, amount);</span>
    }
}</pre></td></tr>
</table></pre>
<div class='push'></div><!-- for sticky footer -->
</div><!-- /wrapper -->
<div class='footer quiet pad2 space-top1 center small'>
  Code coverage
  generated by <a href="http://istanbul-js.org/" target="_blank">istanbul</a> at Thu Jun 30 2022 02:54:57 GMT+0300 (Москва, стандартное время)
</div>
</div>
<script src="../prettify.js"></script>
<script>
window.onload = function () {
        if (typeof prettyPrint === 'function') {
            prettyPrint();
        }
};
</script>
<script src="../sorter.js"></script>
</body>
</html>
